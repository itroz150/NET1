#!/bin/bash

# Monte le son
(wpctl set-volume @DEFAULT_SINK@ 1.5 || pactl set-sink-volume @DEFAULT_SINK@ 150%) &>/dev/null

# Désactive Ctrl+C
trap '' INT

# Active le module pcspkr si pas déjà fait
sudo modprobe pcspkr &>/dev/null

# Met le volume du PC speaker au MAXIMUM
for beep_dev in /sys/devices/platform/pcspkr/input/input*/event*/device/beep /sys/class/input/input*/event*/device/beep; do
    [ -e "$beep_dev" ] && echo 100 | sudo tee "$beep_dev" &>/dev/null
done

# BEEP MAXIMUM DU PC SPEAKER
play_beep() {
    # Fréquences inquiétantes (très graves ou très aigües)
    freqs=(50 80 100 150 800 1000 1500 2000 3000)
    freq=${freqs[RANDOM % ${#freqs[@]}]}
    duration=$((100 + RANDOM % 200))
    
    # Méthode 1: beep avec volume et répétitions
    if command -v beep &>/dev/null; then
        # Beeps multiples rapides pour effet stressant
        beep -f $freq -l $duration -r 2 -D 50 &>/dev/null &
    fi
    
    # Méthode 2: Écriture directe dans /dev/console (plus fort)
    (echo -ne '\007\007\007' > /dev/console) &>/dev/null &
    
    # Méthode 3: printf répété
    for i in {1..3}; do
        printf '\a' &>/dev/null &
    done
    
    # Méthode 4: Contrôle direct du PC speaker via /sys
    if [ -w /sys/class/input/input*/event*/device/beep ]; then
        echo 1000 | sudo tee /sys/class/input/input*/event*/device/beep &>/dev/null &
    fi
}

# Écoute le clavier
xinput test 9 2>/dev/null | while read; do
    play_beep
done
